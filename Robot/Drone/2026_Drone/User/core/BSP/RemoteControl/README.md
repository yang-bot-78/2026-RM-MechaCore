# å¤§ç–† DT7 é¥æ§å™¨åº“ä½¿ç”¨è¯´æ˜

## ç›®å½•

- [ç®€ä»‹](#ç®€ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [æ•°æ®åè®®](#æ•°æ®åè®®)
  - [æ•°æ®åŒ…ç»“æ„](#æ•°æ®åŒ…ç»“æ„)
  - [é€šé“æ•°æ®æ˜ å°„](#é€šé“æ•°æ®æ˜ å°„)
  - [å¼€å…³çŠ¶æ€ç¼–ç ](#å¼€å…³çŠ¶æ€ç¼–ç )
  - [é”®ç›˜æŒ‰é”®æ˜ å°„](#é”®ç›˜æŒ‰é”®æ˜ å°„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
  - [æ–¹æ³•ä¸€ï¼šä¸­æ–­æ¨¡å¼ï¼ˆHAL_UART_Receive_ITï¼‰](#æ–¹æ³•ä¸€ä½¿ç”¨-hal_uart_receive_it--hal_uart_rxcpltcallback)
  - [æ–¹æ³•äºŒï¼šDMA + ç©ºé—²ä¸­æ–­æ¨¡å¼ï¼ˆæ¨èï¼‰](#æ–¹æ³•äºŒä½¿ç”¨-hal_uartex_receivetoidle_dma--hal_uartex_rxeventcallbackæ¨è)
- [API æ¥å£è¯´æ˜](#api-æ¥å£è¯´æ˜)
  - [æ•°æ®è§£æ](#æ•°æ®è§£æ)
  - [é€šé“æ•°æ®è·å–](#é€šé“æ•°æ®è·å–)
  - [æ‘‡æ†ä½ç½®è·å–](#æ‘‡æ†ä½ç½®è·å–)
  - [å¼€å…³çŠ¶æ€è·å–](#å¼€å…³çŠ¶æ€è·å–)
  - [é¼ æ ‡æ•°æ®è·å–](#é¼ æ ‡æ•°æ®è·å–)
  - [é”®ç›˜æŒ‰é”®æ£€æµ‹](#é”®ç›˜æŒ‰é”®æ£€æµ‹)
  - [è¿æ¥çŠ¶æ€ç›‘æ§](#è¿æ¥çŠ¶æ€ç›‘æ§)
- [å®Œæ•´ä½¿ç”¨ç¤ºä¾‹](#å®Œæ•´ä½¿ç”¨ç¤ºä¾‹)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
- [ä¾èµ–é¡¹](#ä¾èµ–é¡¹)
- [ç‰ˆæœ¬ä¿¡æ¯](#ç‰ˆæœ¬ä¿¡æ¯)

---

## ç®€ä»‹

**å¤§ç–† DT7 é¥æ§å™¨åº“**æ˜¯ä¸€ä¸ªç”¨äºè§£æ DT7 é¥æ§å™¨é€šä¿¡åè®®çš„ C++ åº“ã€‚DT7 é¥æ§å™¨é€šè¿‡ **UART æ¥å£**ä»¥å›ºå®šé¢‘ç‡ï¼ˆçº¦ 100Hzï¼‰å‘é€ **18 å­—èŠ‚**çš„æ•°æ®åŒ…ï¼ŒåŒ…å«ï¼š

- ğŸ•¹ï¸ **4 ä¸ªæ‘‡æ†é€šé“**ï¼ˆå·¦å³æ‘‡æ†çš„ X/Y è½´ï¼‰
- ğŸ”˜ **2 ä¸ªä¸‰ä½å¼€å…³**ï¼ˆS1ã€S2ï¼‰
- ğŸ–±ï¸ **é¼ æ ‡æ•°æ®**ï¼ˆX/Y/Z ç§»åŠ¨é‡åŠå·¦å³é”®çŠ¶æ€ï¼‰
- âŒ¨ï¸ **16 ä¸ªé”®ç›˜æŒ‰é”®**ï¼ˆä½æ©ç æ–¹å¼ï¼‰

æœ¬åº“è‡ªåŠ¨è§£æè¿™äº›åŸå§‹æ•°æ®ï¼Œå¹¶æä¾›ï¼š
- å½’ä¸€åŒ–çš„æ‘‡æ†ä½ç½®å€¼ï¼ˆ-1.0 ~ 1.0ï¼‰
- ä»¥ä¸­å€¼ä¸ºä¸­å¿ƒçš„åŸå§‹åæ ‡ï¼ˆ-660 ~ +660ï¼‰
- è¿æ¥çŠ¶æ€ç›‘æ§ï¼ˆåŸºäºæ¥æ”¶è¶…æ—¶ï¼‰

## æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| ğŸ“¦ **æ•°æ®è§£æ** | è‡ªåŠ¨è§£æ 18 å­—èŠ‚ DT7 æ•°æ®åŒ… |
| ğŸ® **æ‘‡æ†é€šé“** | æå– 4 ä¸ªé€šé“æ•°æ®ï¼ˆch0-ch3ï¼‰ |
| ğŸ“Š **å½’ä¸€åŒ–è¾“å‡º** | æ‘‡æ†ä½ç½®å½’ä¸€åŒ–åˆ° -1.0 ~ 1.0 èŒƒå›´ |
| ğŸ”˜ **å¼€å…³æ£€æµ‹** | æ”¯æŒ S1ã€S2 ä¸‰ä½å¼€å…³çŠ¶æ€è¯»å– |
| ğŸ–±ï¸ **é¼ æ ‡æ”¯æŒ** | è¯»å–é¼ æ ‡ç§»åŠ¨é‡å’ŒæŒ‰é”®çŠ¶æ€ |
| âŒ¨ï¸ **é”®ç›˜æ”¯æŒ** | 16 ä¸ªæŒ‰é”®ä½æ©ç æ£€æµ‹ |
| â±ï¸ **çŠ¶æ€ç›‘æ§** | è‡ªåŠ¨æ£€æµ‹è¿æ¥çŠ¶æ€ï¼ˆè¶…æ—¶ç›‘æ§ï¼‰ |
| ğŸ“ **åæ ‡è¾“å‡º** | æä¾›åŸå§‹åæ ‡æ•°æ®ï¼ˆä»¥ä¸­å€¼ä¸ºä¸­å¿ƒï¼‰ |

## æ•°æ®åè®®

### æ•°æ®åŒ…ç»“æ„

DT7 é¥æ§å™¨é€šè¿‡ UART å‘é€å›ºå®šçš„ **18 å­—èŠ‚**æ•°æ®åŒ…ï¼Œæ•°æ®åŒ…ç»“æ„å¦‚ä¸‹ï¼š

| å­—èŠ‚èŒƒå›´ | æ•°æ®å†…å®¹ | æ•°æ®ç±»å‹ | è¯´æ˜ |
|---------|---------|---------|------|
| 0-5 | é€šé“æ•°æ® | ä½æ‰“åŒ… | ch0-ch3ï¼ˆå„11ä½ï¼‰ã€æ»šè½®ã€S1ï¼ˆ2ä½ï¼‰ã€S2ï¼ˆ2ä½ï¼‰ |
| 6-7 | é¼ æ ‡ X è½´ | int16_t | é¼ æ ‡ X è½´ç§»åŠ¨é‡ï¼ˆå°ç«¯åºï¼‰ |
| 8-9 | é¼ æ ‡ Y è½´ | int16_t | é¼ æ ‡ Y è½´ç§»åŠ¨é‡ï¼ˆå°ç«¯åºï¼‰ |
| 10-11 | é¼ æ ‡ Z è½´ | int16_t | é¼ æ ‡ Z è½´ç§»åŠ¨é‡/æ»šè½®ï¼ˆå°ç«¯åºï¼‰ |
| 12 | é¼ æ ‡å·¦é”® | uint8_t | é¼ æ ‡å·¦é”®çŠ¶æ€ï¼ˆéé›¶è¡¨ç¤ºæŒ‰ä¸‹ï¼‰ |
| 13 | é¼ æ ‡å³é”® | uint8_t | é¼ æ ‡å³é”®çŠ¶æ€ï¼ˆéé›¶è¡¨ç¤ºæŒ‰ä¸‹ï¼‰ |
| 14-15 | é”®ç›˜æŒ‰é”® | uint16_t | 16 ä½æŒ‰é”®ä½æ©ç ï¼ˆå°ç«¯åºï¼‰ |
| 16-17 | æ»šè½®å€¼ | int16_t | æ»šè½®/æ»‘è½®åŸå§‹å€¼ï¼ˆå°ç«¯åºï¼‰ |

> **æ³¨æ„**ï¼šæ‰€æœ‰å¤šå­—èŠ‚æ•°æ®å‡é‡‡ç”¨**å°ç«¯åºï¼ˆLittle-Endianï¼‰**æ ¼å¼ã€‚

### é€šé“æ•°æ®æ˜ å°„

| é€šé“ | å¯¹åº”æ‘‡æ† | æ–¹å‘ | åŸå§‹å€¼èŒƒå›´ | åæ ‡èŒƒå›´ |
|------|---------|------|-----------|---------|
| **ch0** | å³æ‘‡æ† | X è½´ | 364 ~ 1684 | -660 ~ +660 |
| **ch1** | å³æ‘‡æ† | Y è½´ | 364 ~ 1684 | -660 ~ +660 |
| **ch2** | å·¦æ‘‡æ† | X è½´ | 364 ~ 1684 | -660 ~ +660 |
| **ch3** | å·¦æ‘‡æ† | Y è½´ | 364 ~ 1684 | -660 ~ +660 |

**é‡è¦å‚æ•°**ï¼š
- **ä¸­å€¼**ï¼š1024
- **æœ€å°å€¼**ï¼š364
- **æœ€å¤§å€¼**ï¼š1684
- **åæ ‡èŒƒå›´**ï¼š-660 ~ +660ï¼ˆå·²å‡å»ä¸­å€¼ï¼Œ0 è¡¨ç¤ºä¸­ä½ï¼‰

### å¼€å…³çŠ¶æ€ç¼–ç 

S1 å’Œ S2 å‡ä¸º**ä¸‰ä½å¼€å…³**ï¼ŒçŠ¶æ€ç¼–ç å¦‚ä¸‹ï¼š

| å¼€å…³ä½ç½® | ç¼–ç å€¼ | æšä¸¾å¸¸é‡ | è¯´æ˜ |
|---------|--------|---------|------|
| **ä¸Š (UP)** | `1` | `SwitchPosition::UP` | å¼€å…³æ‹¨åˆ°æœ€ä¸Šæ–¹ |
| **ä¸­ (MIDDLE)** | `3` | `SwitchPosition::MIDDLE` | å¼€å…³æ‹¨åˆ°ä¸­é—´ä½ç½® |
| **ä¸‹ (DOWN)** | `2` | `SwitchPosition::DOWN` | å¼€å…³æ‹¨åˆ°æœ€ä¸‹æ–¹ |

### é”®ç›˜æŒ‰é”®æ˜ å°„

æ”¯æŒ **16 ä¸ªæŒ‰é”®**ï¼Œé‡‡ç”¨ä½æ©ç æ–¹å¼æ£€æµ‹ï¼ŒæŒ‰é”®ä½å®šä¹‰å¦‚ä¸‹ï¼š

| ä½ä½ç½® | æŒ‰é”® | ä½ä½ç½® | æŒ‰é”® |
|--------|------|--------|------|
| 0 | `KEY_W` | 8 | `KEY_R` |
| 1 | `KEY_S` | 9 | `KEY_F` |
| 2 | `KEY_A` | 10 | `KEY_G` |
| 3 | `KEY_D` | 11 | `KEY_Z` |
| 4 | `KEY_SHIFT` | 12 | `KEY_X` |
| 5 | `KEY_CTRL` | 13 | `KEY_C` |
| 6 | `KEY_Q` | 14 | `KEY_V` |
| 7 | `KEY_E` | 15 | `KEY_B` |

æŒ‰é”®çŠ¶æ€é€šè¿‡ `get_key()` å‡½æ•°æ£€æµ‹ï¼Œæ”¯æŒç»„åˆé”®æ£€æµ‹ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. åŒ…å«å¤´æ–‡ä»¶

```cpp
#include "BSP/RemoteControl/DT7.hpp"
```

### 2. åˆ›å»ºé¥æ§å™¨å¯¹è±¡

```cpp
// åˆ›å»ºé¥æ§å™¨å¯¹è±¡ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 100ms
// å¦‚æœåœ¨ 100ms å†…æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ï¼Œè®¾å¤‡å°†è¢«æ ‡è®°ä¸ºç¦»çº¿
BSP::REMOTE_CONTROL::RemoteController remote_controller(100);
```

### 3. é…ç½® UART æ¥æ”¶ç¼“å†²åŒº

```cpp
// DT7 æ•°æ®åŒ…å›ºå®šé•¿åº¦ä¸º 18 å­—èŠ‚
uint8_t dt7_rx_buffer[18] = {0};
```

## ä½¿ç”¨æ–¹æ³•

æœ¬åº“æ”¯æŒä¸¤ç§ UART æ¥æ”¶æ–¹å¼ï¼Œæ¨èä½¿ç”¨æ–¹æ³•äºŒï¼ˆDMA + ç©ºé—²ä¸­æ–­ï¼‰ã€‚

| æ–¹æ³• | æ¥æ”¶å‡½æ•° | å›è°ƒå‡½æ•° | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|------|---------|
| **æ–¹æ³•ä¸€** | `HAL_UART_Receive_IT` | `HAL_UART_RxCpltCallback` | ä¸­æ–­æ¨¡å¼ï¼ŒCPU å ç”¨ä¸­ç­‰ | ç®€å•åº”ç”¨ï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜ |
| **æ–¹æ³•äºŒ** â­ | `HAL_UARTEx_ReceiveToIdle_DMA` | `HAL_UARTEx_RxEventCallback` | DMA + ç©ºé—²ä¸­æ–­ï¼ŒCPU å ç”¨ä½ | **æ¨èä½¿ç”¨**ï¼Œé«˜é€Ÿæ•°æ®æ¥æ”¶ |

### æ–¹æ³•ä¸€ï¼šä¸­æ–­æ¨¡å¼ï¼ˆHAL_UART_Receive_ITï¼‰

é€‚ç”¨äºä¸­æ–­æ¨¡å¼æ¥æ”¶å›ºå®šé•¿åº¦æ•°æ®åŒ…ã€‚

#### åˆå§‹åŒ–æ¥æ”¶

åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶å¯åŠ¨æ¥æ”¶ï¼š

```cpp
// åˆå§‹åŒ–å®Œæˆåå¯åŠ¨æ¥æ”¶
HAL_UART_Receive_IT(&huart1, dt7_rx_buffer, 18);
```

#### æ¥æ”¶å®Œæˆå›è°ƒ

åœ¨ `stm32xx_it.c` æˆ–åº”ç”¨å±‚å®ç°å›è°ƒå‡½æ•°ï¼š

```cpp
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)
{
    // æ£€æŸ¥æ˜¯å“ªä¸ª UART è§¦å‘çš„ä¸­æ–­
    if (huart == &huart1)
    {
        // è§£ææ¥æ”¶åˆ°çš„æ•°æ®
        remote_controller.parseData(dt7_rx_buffer);
        
        // ç»§ç»­æ¥æ”¶ä¸‹ä¸€å¸§æ•°æ®
        HAL_UART_Receive_IT(&huart1, dt7_rx_buffer, 18);
    }
}
```

| æ³¨æ„äº‹é¡¹ | è¯´æ˜ |
|---------|------|
| âš ï¸ **æ¥æ”¶é‡å¯** | å¿…é¡»åœ¨å›è°ƒä¸­é‡æ–°å¯åŠ¨æ¥æ”¶ï¼Œå¦åˆ™åªä¼šæ¥æ”¶ä¸€æ¬¡ |
| âš ï¸ **é‡å¤å¯åŠ¨æ£€æŸ¥** | å¦‚æœæ•°æ®æ¥æ”¶é€Ÿåº¦è¾ƒå¿«ï¼Œå»ºè®®æ£€æŸ¥æ¥æ”¶çŠ¶æ€é¿å…é‡å¤å¯åŠ¨ |

### æ–¹æ³•äºŒï¼šDMA + ç©ºé—²ä¸­æ–­æ¨¡å¼ï¼ˆæ¨èï¼‰â­

é€‚ç”¨äº DMA + ç©ºé—²ä¸­æ–­æ¨¡å¼ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ•°æ®å¸§ç»“æŸï¼Œç‰¹åˆ«é€‚åˆä¸å®šé•¿æˆ–å›ºå®šé•¿åº¦æ•°æ®æ¥æ”¶ã€‚

#### åˆå§‹åŒ–æ¥æ”¶

åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶å¯åŠ¨æ¥æ”¶ï¼š

```cpp
// å¯åŠ¨ DMA æ¥æ”¶å¹¶å¯ç”¨ç©ºé—²ä¸­æ–­
HAL_UARTEx_ReceiveToIdle_DMA(&huart1, dt7_rx_buffer, 18);
```

#### ç©ºé—²ä¸­æ–­å›è°ƒ

åœ¨ `stm32xx_it.c` æˆ–åº”ç”¨å±‚å®ç°å›è°ƒå‡½æ•°ï¼š

```cpp
void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size)
{
    // æ£€æŸ¥æ˜¯å“ªä¸ª UART è§¦å‘çš„ä¸­æ–­
    if (huart == &huart1)
    {
        // Size å‚æ•°è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦
        // å¯¹äº DT7ï¼Œåº”è¯¥å§‹ç»ˆæ˜¯ 18 å­—èŠ‚
        if (Size == 18)
        {
            // è§£ææ¥æ”¶åˆ°çš„æ•°æ®
            remote_controller.parseData(dt7_rx_buffer);
        }
        
        // æ¸…é™¤ ORE é”™è¯¯ï¼ˆå¦‚æœå­˜åœ¨ï¼‰å¹¶é‡å¯æ¥æ”¶
        if (__HAL_UART_GET_FLAG(huart, UART_FLAG_ORE) != RESET)
        {
            __HAL_UART_CLEAR_OREFLAG(huart);
        }
        
        // ç»§ç»­æ¥æ”¶ä¸‹ä¸€å¸§æ•°æ®
        HAL_UARTEx_ReceiveToIdle_DMA(&huart1, dt7_rx_buffer, 18);
    }
}
```

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| âœ… **è‡ªåŠ¨æ£€æµ‹** | é€šè¿‡ç©ºé—²ä¸­æ–­è‡ªåŠ¨æ£€æµ‹æ•°æ®å¸§ç»“æŸ |
| âœ… **ä½ CPU å ç”¨** | DMA ä¼ è¾“ï¼ŒCPU å ç”¨ä½ |
| âœ… **è‡ªåŠ¨å¤„ç†è¾¹ç•Œ** | è‡ªåŠ¨å¤„ç†æ•°æ®è¾¹ç•Œ |
| âœ… **é«˜é€Ÿæ¥æ”¶** | é€‚åˆé«˜é€Ÿæ•°æ®æ¥æ”¶ï¼ˆ100Hz+ï¼‰ |

## API æ¥å£è¯´æ˜

### æ•°æ®è§£æ

| å‡½æ•° | è¯´æ˜ | å‚æ•° |
|------|------|------|
| `void parseData(const uint8_t *data)` | è§£æ 18 å­—èŠ‚çš„ DT7 æ•°æ®åŒ… | `data`: æŒ‡å‘ 18 å­—èŠ‚æ•°æ®ç¼“å†²åŒºçš„æŒ‡é’ˆ |

> **ä½¿ç”¨æ—¶æœº**ï¼šåº”åœ¨ UART æ¥æ”¶å›è°ƒä¸­è°ƒç”¨æ­¤å‡½æ•°ã€‚

```cpp
void parseData(const uint8_t *data);
```

### é€šé“æ•°æ®è·å–ï¼ˆåŸå§‹å€¼ï¼‰

| å‡½æ•° | å¯¹åº”é€šé“ | æ•°æ®ç±»å‹ | è¿”å›å€¼èŒƒå›´ |
|------|---------|---------|-----------|
| `get_ch0()` | é€šé“ 0ï¼ˆå³æ‘‡æ† Xï¼‰ | `int16_t` | 364 ~ 1684ï¼ˆä¸­å€¼ï¼š1024ï¼‰ |
| `get_ch1()` | é€šé“ 1ï¼ˆå³æ‘‡æ† Yï¼‰ | `int16_t` | 364 ~ 1684ï¼ˆä¸­å€¼ï¼š1024ï¼‰ |
| `get_ch2()` | é€šé“ 2ï¼ˆå·¦æ‘‡æ† Xï¼‰ | `int16_t` | 364 ~ 1684ï¼ˆä¸­å€¼ï¼š1024ï¼‰ |
| `get_ch3()` | é€šé“ 3ï¼ˆå·¦æ‘‡æ† Yï¼‰ | `int16_t` | 364 ~ 1684ï¼ˆä¸­å€¼ï¼š1024ï¼‰ |
| `get_scroll()` | æ»šè½®åŸå§‹å€¼ | `int16_t` | èŒƒå›´å–å†³äºæ»šè½®ç¡¬ä»¶ |

```cpp
int16_t get_ch0() const;      // é€šé“ 0ï¼ˆå³æ‘‡æ† Xï¼‰
int16_t get_ch1() const;      // é€šé“ 1ï¼ˆå³æ‘‡æ† Yï¼‰
int16_t get_ch2() const;      // é€šé“ 2ï¼ˆå·¦æ‘‡æ† Xï¼‰
int16_t get_ch3() const;      // é€šé“ 3ï¼ˆå·¦æ‘‡æ† Yï¼‰
int16_t get_scroll() const;   // æ»šè½®åŸå§‹å€¼
```

### æ‘‡æ†ä½ç½®è·å–ï¼ˆå½’ä¸€åŒ–ï¼‰

| å‡½æ•° | å¯¹åº”æ‘‡æ† | æ•°æ®ç±»å‹ | è¿”å›å€¼èŒƒå›´ |
|------|---------|---------|-----------|
| `get_left_x()` | å·¦æ‘‡æ† X è½´ | `float` | -1.0 ~ 1.0ï¼ˆ0.0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_left_y()` | å·¦æ‘‡æ† Y è½´ | `float` | -1.0 ~ 1.0ï¼ˆ0.0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_right_x()` | å³æ‘‡æ† X è½´ | `float` | -1.0 ~ 1.0ï¼ˆ0.0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_right_y()` | å³æ‘‡æ† Y è½´ | `float` | -1.0 ~ 1.0ï¼ˆ0.0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_scroll()` | æ»šè½®å½’ä¸€åŒ–å€¼ | `float` | -1.0 ~ 1.0ï¼ˆ0.0 è¡¨ç¤ºä¸­ä½ï¼‰ |

```cpp
float get_left_x() const;     // å·¦æ‘‡æ† Xï¼ˆ-1.0 ~ 1.0ï¼‰
float get_left_y() const;     // å·¦æ‘‡æ† Yï¼ˆ-1.0 ~ 1.0ï¼‰
float get_right_x() const;    // å³æ‘‡æ† Xï¼ˆ-1.0 ~ 1.0ï¼‰
float get_right_y() const;    // å³æ‘‡æ† Yï¼ˆ-1.0 ~ 1.0ï¼‰
float get_scroll() const;      // æ»šè½®å½’ä¸€åŒ–å€¼ï¼ˆ-1.0 ~ 1.0ï¼‰
```

### æ‘‡æ†åæ ‡è·å–ï¼ˆä»¥ä¸­å€¼ä¸ºä¸­å¿ƒï¼‰

| å‡½æ•° | å¯¹åº”æ‘‡æ† | æ•°æ®ç±»å‹ | è¿”å›å€¼èŒƒå›´ |
|------|---------|---------|-----------|
| `get_left_stick_x()` | å·¦æ‘‡æ† X è½´ | `int16_t` | -660 ~ +660ï¼ˆ0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_left_stick_y()` | å·¦æ‘‡æ† Y è½´ | `int16_t` | -660 ~ +660ï¼ˆ0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_right_stick_x()` | å³æ‘‡æ† X è½´ | `int16_t` | -660 ~ +660ï¼ˆ0 è¡¨ç¤ºä¸­ä½ï¼‰ |
| `get_right_stick_y()` | å³æ‘‡æ† Y è½´ | `int16_t` | -660 ~ +660ï¼ˆ0 è¡¨ç¤ºä¸­ä½ï¼‰ |

```cpp
int16_t get_left_stick_x() const;    // å·¦æ‘‡æ† Xï¼ˆ-660 ~ +660ï¼‰
int16_t get_left_stick_y() const;    // å·¦æ‘‡æ† Yï¼ˆ-660 ~ +660ï¼‰
int16_t get_right_stick_x() const;   // å³æ‘‡æ† Xï¼ˆ-660 ~ +660ï¼‰
int16_t get_right_stick_y() const;   // å³æ‘‡æ† Yï¼ˆ-660 ~ +660ï¼‰
```

### å¼€å…³çŠ¶æ€è·å–

| å‡½æ•° | å¼€å…³ | è¿”å›å€¼ | æšä¸¾å¸¸é‡ |
|------|------|--------|---------|
| `get_s1()` | S1 å¼€å…³ | `uint8_t` | `SwitchPosition::UP` = 1<br>`SwitchPosition::MIDDLE` = 3<br>`SwitchPosition::DOWN` = 2 |
| `get_s2()` | S2 å¼€å…³ | `uint8_t` | åŒä¸Š |

```cpp
uint8_t get_s1() const;  // S1 å¼€å…³çŠ¶æ€
uint8_t get_s2() const;  // S2 å¼€å…³çŠ¶æ€

// ä½¿ç”¨ç¤ºä¾‹
if (remote_controller.get_s1() == BSP::REMOTE_CONTROL::RemoteController::SwitchPosition::UP)
{
    // S1 åœ¨ä¸Šä½ç½®
}
```

### é¼ æ ‡æ•°æ®è·å–

| å‡½æ•° | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `get_mouseLeft()` | é¼ æ ‡å·¦é”®çŠ¶æ€ | `bool` |
| `get_mouseRight()` | é¼ æ ‡å³é”®çŠ¶æ€ | `bool` |

```cpp
bool get_mouseLeft() const;   // é¼ æ ‡å·¦é”®çŠ¶æ€
bool get_mouseRight() const;  // é¼ æ ‡å³é”®çŠ¶æ€
```

> âš ï¸ **æ³¨æ„**ï¼šé¼ æ ‡ X/Y/Z ç§»åŠ¨é‡æš‚æœªæä¾›ç›´æ¥æ¥å£ï¼Œå¦‚éœ€è®¿é—®å¯é€šè¿‡å†…éƒ¨æ•°æ®ç»“æ„æˆ–ä¿®æ”¹åº“æ·»åŠ æ¥å£ã€‚

### é”®ç›˜æŒ‰é”®æ£€æµ‹

| å‡½æ•° | è¯´æ˜ | å‚æ•° | è¿”å›å€¼ |
|------|------|------|--------|
| `get_key()` | æ£€æµ‹æŒ‡å®šæŒ‰é”®æ˜¯å¦æŒ‰ä¸‹ | `Keyboard key`: æŒ‰é”®æšä¸¾å¸¸é‡ | `bool` |

```cpp
bool get_key(Keyboard key) const;

// ä½¿ç”¨ç¤ºä¾‹ï¼šå•é”®æ£€æµ‹
if (remote_controller.get_key(BSP::REMOTE_CONTROL::RemoteController::KEY_W))
{
    // W é”®è¢«æŒ‰ä¸‹
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šç»„åˆé”®æ£€æµ‹
if (remote_controller.get_key(RemoteController::KEY_SHIFT) && 
    remote_controller.get_key(RemoteController::KEY_W))
{
    // Shift + W è¢«æŒ‰ä¸‹
}
```

### è¿æ¥çŠ¶æ€ç›‘æ§

| å‡½æ•° | è¯´æ˜ | è¿”å›å€¼ |
|------|------|--------|
| `isConnected()` | æ£€æŸ¥é¥æ§å™¨æ˜¯å¦åœ¨çº¿ | `bool`ï¼ˆtrue = åœ¨çº¿ï¼Œfalse = ç¦»çº¿ï¼‰ |
| `getDisconnectedTime()` | è·å–æ–­è”æ—¶é—´ | `uint32_t`ï¼ˆæ¯«ç§’ï¼Œåœ¨çº¿æ—¶è¿”å› 0ï¼‰ |

çŠ¶æ€ç›‘æ§åŸºäºæ•°æ®æ¥æ”¶æ—¶é—´æˆ³ã€‚å¦‚æœè¶…è¿‡æ„é€ å‡½æ•°ä¸­è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 100msï¼‰æœªæ”¶åˆ°æ•°æ®ï¼Œè®¾å¤‡å°†è¢«æ ‡è®°ä¸ºç¦»çº¿ã€‚

```cpp
bool isConnected() const;              // æ£€æŸ¥æ˜¯å¦åœ¨çº¿
uint32_t getDisconnectedTime() const;  // è·å–æ–­è”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

// ä½¿ç”¨ç¤ºä¾‹
if (remote_controller.isConnected())
{
    // é¥æ§å™¨åœ¨çº¿ï¼Œä½¿ç”¨æ•°æ®
    float left_x = remote_controller.get_left_x();
    // ...
}
else
{
    // é¥æ§å™¨ç¦»çº¿ï¼Œæ‰§è¡Œå®‰å…¨æªæ–½
    uint32_t offline_time = remote_controller.getDisconnectedTime();
    // ...
}
```

## å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```cpp
#include "BSP/RemoteControl/DT7.hpp"
#include "usart.h"

// å…¨å±€å¯¹è±¡
BSP::REMOTE_CONTROL::RemoteController remote_controller(100);
uint8_t dt7_rx_buffer[18] = {0};

// åˆå§‹åŒ–å‡½æ•°
void RemoteController_Init(void)
{
    // å¯åŠ¨ DMA + ç©ºé—²ä¸­æ–­æ¥æ”¶
    HAL_UARTEx_ReceiveToIdle_DMA(&huart1, dt7_rx_buffer, 18);
}

// ç©ºé—²ä¸­æ–­å›è°ƒï¼ˆåœ¨ stm32xx_it.c ä¸­å®ç°ï¼‰
void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size)
{
    if (huart == &huart1 && Size == 18)
    {
        // è§£ææ•°æ®
        remote_controller.parseData(dt7_rx_buffer);
        
        // æ¸…é™¤ ORE é”™è¯¯å¹¶é‡å¯æ¥æ”¶
        if (__HAL_UART_GET_FLAG(huart, UART_FLAG_ORE) != RESET)
        {
            __HAL_UART_CLEAR_OREFLAG(huart);
        }
        HAL_UARTEx_ReceiveToIdle_DMA(&huart1, dt7_rx_buffer, 18);
    }
}

// ä¸»å¾ªç¯ä¸­ä½¿ç”¨
void MainLoop(void)
{
    if (remote_controller.isConnected())
    {
        // è·å–æ‘‡æ†æ•°æ®
        float left_x = remote_controller.get_left_x();
        float left_y = remote_controller.get_left_y();
        float right_x = remote_controller.get_right_x();
        float right_y = remote_controller.get_right_y();
        
        // è·å–å¼€å…³çŠ¶æ€
        uint8_t s1 = remote_controller.get_s1();
        uint8_t s2 = remote_controller.get_s2();
        
        // æ£€æµ‹æŒ‰é”®
        if (remote_controller.get_key(RemoteController::KEY_W))
        {
            // W é”®è¢«æŒ‰ä¸‹
        }
        
        // ä½¿ç”¨æ‘‡æ†æ•°æ®æ§åˆ¶æœºå™¨äºº...
    }
    else
    {
        // é¥æ§å™¨ç¦»çº¿ï¼Œæ‰§è¡Œå®‰å…¨åœæ­¢
    }
}
```

## æ³¨æ„äº‹é¡¹

| æ³¨æ„äº‹é¡¹ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| âš ï¸ **ç¼“å†²åŒºå¤§å°** | DT7 æ•°æ®åŒ…å›ºå®šä¸º 18 å­—èŠ‚ | æ¥æ”¶ç¼“å†²åŒºå¿…é¡»è‡³å°‘ä¸º 18 å­—èŠ‚ |
| âš ï¸ **æ¥æ”¶é‡å¯** | ä½¿ç”¨ä¸­æ–­æˆ– DMA æ¨¡å¼æ—¶ï¼Œå¿…é¡»åœ¨å›è°ƒä¸­é‡æ–°å¯åŠ¨æ¥æ”¶ | åœ¨å›è°ƒå‡½æ•°ä¸­è°ƒç”¨æ¥æ”¶å‡½æ•°é‡æ–°å¯åŠ¨æ¥æ”¶ |
| âš ï¸ **ORE é”™è¯¯å¤„ç†** | é«˜é€Ÿæ¥æ”¶æ—¶å¯èƒ½å‡ºç° OREï¼ˆè¿‡è½½é”™è¯¯ï¼‰ | åœ¨å›è°ƒä¸­æ£€æŸ¥å¹¶æ¸…é™¤ `UART_FLAG_ORE` é”™è¯¯æ ‡å¿— |
| âš ï¸ **è¶…æ—¶è®¾ç½®** | è¶…æ—¶æ—¶é—´éœ€æ ¹æ®é€šä¿¡é¢‘ç‡è°ƒæ•´ | DT7 é€šå¸¸ä»¥çº¦ 100Hz å‘é€æ•°æ®ï¼Œå»ºè®®è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 50-100ms |
| âš ï¸ **çº¿ç¨‹å®‰å…¨** | æœ¬åº“æœªå®ç°çº¿ç¨‹å®‰å…¨æœºåˆ¶ | å¦‚æœä»å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œéœ€è¦è‡ªè¡Œæ·»åŠ äº’æ–¥é”ä¿æŠ¤ |
| âš ï¸ **æ•°æ®æœ‰æ•ˆæ€§** | `parseData()` ä»…æ£€æŸ¥ç©ºæŒ‡é’ˆ | ä¸éªŒè¯æ•°æ®åŒ…æ­£ç¡®æ€§ï¼ˆå¦‚æ ¡éªŒå’Œï¼‰ï¼Œåº”ç”¨å±‚å¯æ ¹æ®éœ€è¦æ·»åŠ éªŒè¯ |

## ä¾èµ–é¡¹

| ä¾èµ–é¡¹ | è¯´æ˜ | ç”¨é€” |
|--------|------|------|
| `BSP/Common/StateWatch/state_watch.hpp` | è®¾å¤‡çŠ¶æ€ç›‘æ§åº“ | æä¾›è¿æ¥çŠ¶æ€ç›‘æ§åŠŸèƒ½ |
| STM32 HAL åº“ | STM32 ç¡¬ä»¶æŠ½è±¡å±‚ | UART é€šä¿¡æ¥å£ |

## ç‰ˆæœ¬ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| **åº“åç§°** | DT7 é¥æ§å™¨åº“ |
| **å½“å‰ç‰ˆæœ¬** | `v1.0.0` |
| **å‘½åç©ºé—´** | `BSP::REMOTE_CONTROL` |

## è®¸å¯è¯

Copyright SZPU-RCIA (c) 2025

